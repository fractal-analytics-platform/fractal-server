# This file is identical to 'tests/data/slurm_docker_images/docker-compose.yml'
# The only difference is '/private:/private:rw' in place of '/tmp:/tmp:rw'
# See https://github.com/fractal-analytics-platform/fractal-server/issues/1475

services:

  slurmmaster:
        build:
          context: ./master
          dockerfile: Dockerfile
        hostname: slurmmaster
        user: admin
        volumes:
          - /private:/private:rw

        environment:
                - SLURM_CPUS_ON_NODE=1
        ports:
                - 6817:6817
                - 6818:6818
                - 6819:6819

  slurmnode1:
        depends_on:
          - "slurmmaster"
        build:
          context: ./node
          dockerfile: Dockerfile
        hostname: slurmnode1
        user: admin
        volumes:
          - /private:/private:rw
        environment:
                - SLURM_NODENAME=slurmnode1
                - SLURM_CPUS_ON_NODE=1
        links:
                - slurmmaster
